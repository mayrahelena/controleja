<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Relat√≥rio - Administra√ß√£o</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='relatorio.css') }}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <main id="report-page">
        <section class="report-container">
            <div class="page-header">
                <a href="{{ url_for('admin') }}" class="btn-voltar">‚Üê Voltar</a>
            </div>
            <h2 class="report-title">Gerar Relat√≥rio</h2>

            <!-- Exibir mensagens flash -->
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="report-flash">
                        {% for msg in messages %}
                            <p>{{ msg }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <!-- Filtro -->
            <form method="post" id="report-filter-form" class="report-filter-form">
                <label for="user_id" class="report-label">Funcion√°ria:</label>
                <select id="user_id" name="user_id" required class="report-input">
                    <option value="todos">Todas</option>
                    {% for u in users %}
                        <option value="{{ u.id }}">{{ u.nome }}</option>
                    {% endfor %}
                </select>

                <label for="data_inicio" class="report-label">Data In√≠cio:</label>
                <input type="date" id="data_inicio" name="data_inicio" required class="report-input" />

                <label for="data_fim" class="report-label">Data Fim:</label>
                <input type="date" id="data_fim" name="data_fim" required class="report-input" />

                <button type="submit" id="btn-report" class="btn-primary report-btn">Gerar</button>
            </form>

            {% if rel_data %}
                {% for user in rel_data.usuarios %}
                    <section class="employee-section employee-print">
                        <!-- ‚úÖ PER√çODO REPETIDO PARA CADA FUNCION√ÅRIO -->
                        <h3 class="report-period">
                            Relat√≥rio para pagamento de {{ rel_data.inicio }} at√© {{ rel_data.fim }}
                        </h3>
                        
                        <h4 class="employee-name">Funcion√°ria: {{ user.nome }}</h4>

                        <!-- Cabe√ßalho (desktop e impress√£o) -->
                        <div class="report-header" aria-hidden="true">
                            <span>Data</span>
                            <span>Entrada</span>
                            <span>Sa√≠da</span>
                            <span>Horas</span>
                            <span>Valor (R$)</span>
                        </div>

                        <!-- Lista de registros -->
                        <section class="report-cards">
                            {% for linha in user.linhas %}
                                <article class="report-card{% if linha.sem_registro %} is-empty{% endif %}">
                                    <p class="report-field">
                                        <strong>Data:</strong>
                                        <span>{{ linha.data }}</span>
                                    </p>
                                    <p class="report-field">
                                        <strong>Entrada:</strong>
                                        <span>{{ linha.entrada }}</span>
                                    </p>
                                    <p class="report-field">
                                        <strong>Sa√≠da:</strong>
                                        <span>{{ linha.saida }}</span>
                                    </p>
                                    <p class="report-field">
                                        <strong>Horas:</strong>
                                        <span>{{ linha.horas }}</span>
                                    </p>
                                    <p class="report-field">
                                        <strong>Valor:</strong>
                                        <span>R$ {{ linha.valor }}</span>
                                    </p>
                                </article>
                            {% endfor %}
                        </section>

                        <!-- Totais -->
                        <section class="report-total">
                            <div class="report-total-row">
                                <span class="spacer"></span>
                                <span class="spacer"></span>
                                <span class="spacer"></span>
                                <span class="hours">Total: {{ user.total_horas }}</span>
                                <span class="amount">R$ {{ user.total_valor }}</span>
                            </div>
                        </section>
                    </section>
                {% endfor %}
            {% endif %}

            <p class="report-actions">
                <button type="button" class="btn-primary report-print-btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
            </p>

            <p class="report-back">
                <a href="{{ url_for('admin') }}" class="btn-voltar">‚Üê Voltar</a>
            </p>
        </section>
    </main>
</body>
</html>
